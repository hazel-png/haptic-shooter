<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>質感マップデモ</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: sans-serif;
      user-select: none;
      touch-action: none;
    }
    #area {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="area"></div>

  <script>
    const area = document.getElementById("area");

    function getTextureType(x, width) {
      const ratio = x / width;
      if (ratio < 0.33) return "metal";   // ザラザラ
      else if (ratio < 0.66) return "fabric"; // サラサラ
      else return "rubber";              // グニグニ
    }

    function vibrateForTexture(type) {
      if (!("vibrate" in navigator)) return;

      switch (type) {
        case "metal":
          navigator.vibrate([5, 10, 5, 10, 5]);
          break;
        case "fabric":
          navigator.vibrate([40]);
          break;
        case "rubber":
          navigator.vibrate([100, 30, 100]);
          break;
      }
    }

    function playNoise(type) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const bufferSize = 4096;
      const noise = ctx.createScriptProcessor(bufferSize, 1, 1);
      noise.onaudioprocess = function (e) {
        const output = e.outputBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          switch (type) {
            case "metal":
              output[i] = Math.random() * 2 - 1;
              break;
            case "fabric":
              output[i] = (Math.random() * 0.2 - 0.1);
              break;
            case "rubber":
              output[i] = Math.sin(i / 10) * 0.3 + (Math.random() * 0.05);
              break;
          }
        }
      };
      noise.connect(ctx.destination);
      setTimeout(() => {
        noise.disconnect();
        ctx.close();
      }, 800);
    }

    area.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      const x = touch.clientX;
      const width = window.innerWidth;
      const type = getTextureType(x, width);

      vibrateForTexture(type);
      playNoise(type);
    });
  </script>
</body>
</html>
